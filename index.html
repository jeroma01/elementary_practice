<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 2 English Review - Damon's Edition</title>
    <!-- ‰ΩøÁî® Tailwind CSS ÈÄ≤Ë°åÊéíÁâà -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ÂºïÂÖ•ÂúñÊ®ôÂ∫´ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts Â≠óÂûã -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <!-- ÂºïÂÖ• confetti ÁâπÊïà (ÊÖ∂Á•ùÁî®Á¥ôËä±) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #ecfeff; /* Êõ¥Ê∏ÖÁàΩÁöÑËóçÁ∂†Ëâ≤ËÉåÊôØ */
            background-image: radial-gradient(#cffafe 2px, transparent 2px);
            background-size: 30px 30px;
        }
        .en-text {
            font-family: 'Fredoka', sans-serif;
        }
        .playing-highlight {
            background-color: #fef9c3 !important; /* ÊüîÂíåÈªÉ */
            border-color: #facc15 !important;
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        }
        /* È†ÅÁ±§ÂàáÊèõÂãïÁï´ */
        .tab-active {
            background-color: #ffffff;
            color: #0ea5e9;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .tab-inactive {
            background-color: rgba(255, 255, 255, 0.4);
            color: #475569;
        }
        
        /* Ê∏¨È©óÊ®°ÂºèÊåâÈàïÊ®£Âºè */
        .quiz-option {
            transition: all 0.2s;
            cursor: pointer;
        }
        .quiz-option:hover {
            transform: scale(1.02);
            background-color: #eff6ff;
        }
        .quiz-option.correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d;
        }
        .quiz-option.wrong {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d;
            opacity: 0.7;
        }
        /* Ë≤ºÁ¥ôÊïàÊûú */
        .sticker-img {
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
            font-size: 2.5rem;
            line-height: 1;
        }
    </style>
</head>
<body class="min-h-screen pb-24 select-none">

    <!-- È†ÇÈÉ®Â∞éËà™ -->
    <header class="bg-gradient-to-r from-cyan-500 to-blue-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-xl md:text-2xl font-bold flex items-center gap-2">
                        <i class="fas fa-graduation-cap"></i> Damon's English
                    </h1>
                </div>
                <!-- Ë™ûÈÄüËàáÂàÜÊï∏ÂçÄ -->
                <div class="flex items-center gap-3">
                    <!-- Ë™ûÈÄüÊéßÂà∂Âô® -->
                    <div class="bg-white/20 rounded-full px-3 py-1 flex items-center gap-2 text-sm backdrop-blur-sm border border-white/30">
                        <i class="fas fa-tachometer-alt text-cyan-100"></i>
                        <select id="speed-select" onchange="updateSpeed()" class="bg-transparent text-white font-bold outline-none cursor-pointer appearance-none">
                            <option value="1.0" class="text-gray-800">1.0x (Normal)</option>
                            <option value="0.75" class="text-gray-800" selected>0.75x (Slow)</option>
                            <option value="0.5" class="text-gray-800">0.5x (Very Slow)</option>
                        </select>
                        <i class="fas fa-chevron-down text-xs text-cyan-100"></i>
                    </div>

                    <!-- ÂàÜÊï∏È°ØÁ§∫ (ÂÉÖÂú®Ê∏¨È©óÊ®°ÂºèÈ°ØÁ§∫) -->
                    <div id="score-board" class="hidden bg-yellow-400/90 text-yellow-900 px-3 py-1 rounded-full shadow-sm">
                        <span class="font-bold text-sm"><i class="fas fa-star"></i> <span id="current-score">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Ê®°ÂºèÂàáÊèõ Tabs -->
            <div class="flex gap-2 p-1 bg-black/10 rounded-xl backdrop-blur-sm">
                <button onclick="switchMode('practice')" id="tab-practice" class="tab-active flex-1 py-2 rounded-lg text-center transition text-sm md:text-base">
                    <i class="fas fa-book-open mr-2"></i>Á∑¥ÁøíÊ®°Âºè
                </button>
                <button onclick="switchMode('quiz')" id="tab-quiz" class="tab-inactive flex-1 py-2 rounded-lg text-center transition text-sm md:text-base">
                    <i class="fas fa-gamepad mr-2"></i>Ê∏¨È©óÊ®°Âºè
                </button>
            </div>
        </div>
    </header>

    <!-- ‰∏ªË¶ÅÂÖßÂÆπÂçÄ -->
    <main class="max-w-4xl mx-auto px-4 py-6">
        
        <!-- 1. Á∑¥ÁøíÊ®°ÂºèÁïåÈù¢ -->
        <div id="view-practice" class="space-y-6">
            <!-- ÂÖ®Â±ÄÊí≠ÊîæÊéßÂà∂ (ÊµÆÂãïÊåâÈàï) -->
            <div class="flex justify-center md:justify-end mb-4 sticky top-40 z-40 pointer-events-none">
                <div class="pointer-events-auto bg-white/90 backdrop-blur-md shadow-lg rounded-full p-1.5 border border-white/50 flex gap-2">
                    <button id="stopBtn" onclick="stopAudio()" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-full shadow transition flex items-center gap-2">
                        <i class="fas fa-stop"></i> Stop
                    </button>
                    <button id="playAllBtn" onclick="playAll()" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-6 rounded-full shadow transition flex items-center gap-2 animate-pulse-slow">
                        <i class="fas fa-play-circle text-xl"></i> Play All
                    </button>
                </div>
            </div>
            
            <div id="content-list" class="space-y-8">
                <!-- Ë™≤Á®ãÂÖßÂÆπÁî± JS ÁîüÊàê -->
            </div>
        </div>

        <!-- 2. Ê∏¨È©óÊ®°ÂºèÁïåÈù¢ -->
        <div id="view-quiz" class="hidden max-w-2xl mx-auto mt-8">
            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-white ring-4 ring-cyan-100">
                <!-- Ê∏¨È©óÁãÄÊÖãÊ¨Ñ -->
                <div class="bg-gradient-to-b from-cyan-50 to-white p-8 text-center border-b border-cyan-100">
                    <div class="relative inline-block group">
                        <div class="absolute inset-0 bg-cyan-400 rounded-full blur opacity-20 group-hover:opacity-40 transition"></div>
                        <div class="relative inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-cyan-100 to-blue-50 text-cyan-600 mb-4 shadow-lg cursor-pointer hover:scale-105 transition border-4 border-white" onclick="playQuizAudio()">
                            <i id="quiz-speaker-icon" class="fas fa-volume-up text-4xl"></i>
                        </div>
                    </div>
                    <p class="text-slate-500 text-sm font-bold mb-1 tracking-wide uppercase">Listen & Choose</p>
                    <p class="text-slate-800 font-black text-xl">ÈªûÊìäÂñáÂè≠ËÅΩÈ°åÁõÆÔºåÈÅ∏Âá∫Ê≠£Á¢∫Á≠îÊ°à</p>
                </div>

                <!-- ÈÅ∏È†ÖÂçÄ -->
                <div id="quiz-options" class="p-6 space-y-4 bg-slate-50 min-h-[300px] flex flex-col justify-center">
                    <!-- ÈÅ∏È†ÖÁî± JS ÁîüÊàê -->
                    <div class="text-center py-10">
                        <button onclick="startQuiz()" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transform transition hover:scale-105 text-lg">
                            <i class="fas fa-rocket mr-2"></i> ÈñãÂßãÊ∏¨È©ó (Start Quiz)
                        </button>
                    </div>
                </div>

                <!-- Â∫ïÈÉ®ÂèçÈ•ã -->
                <div id="quiz-feedback" class="h-14 bg-white border-t border-slate-100 flex items-center justify-center text-sm font-bold text-slate-400">
                    <i class="fas fa-info-circle mr-2"></i> Ê∫ñÂÇôÂ•ΩÂ∞±ÊåâÈñãÂßãÔºÅ
                </div>
            </div>
        </div>

    </main>

    <!-- Â∫ïÈÉ®ÁâàÊ¨ä -->
    <footer class="text-center text-slate-400 text-xs py-8">
        <p>Made for Damon ‚Ä¢ V3.0</p>
    </footer>

    <script>
        // === ÊïôÊùêË≥áÊñôÂ∫´ (V3.0: ÂêçÂ≠óÊõ¥Êñ∞ + ÂúñÁâáËºîÂä©) ===
        // ÊàëÂÄë‰ΩøÁî® Emoji ‰ΩúÁÇ∫ 2D ÂúñÁâáÔºåÂõ†ÁÇ∫ÂÆÉÂÄëÂú®ÊâÄÊúâË£ùÁΩÆ‰∏äÈÉΩÁõ∏ÂÆπ‰∏îÂèØÊÑõ
        const lessonData = [
            {
                category: "Greeting (ÂïèÂÄô)",
                icon: "fa-hand-sparkles",
                color: "border-l-8 border-yellow-400",
                sentences: [
                    { en: "Hi! Good morning.", zh: "Âó®ÔºÅÊó©ÂÆâ„ÄÇ", img: "‚òÄÔ∏è" },
                    { en: "Hello! Good afternoon.", zh: "ÂìàÂõâÔºÅÂçàÂÆâ„ÄÇ", img: "üëã" }
                ]
            },
            {
                category: "1. Self Introduction (Ëá™Êàë‰ªãÁ¥π)",
                subtitle: "Hello, Damon!",
                icon: "fa-id-card",
                color: "border-l-8 border-blue-400",
                sentences: [
                    { en: "My name is Damon.", zh: "ÊàëÁöÑÂêçÂ≠óÊòØ Damon„ÄÇ", img: "üë¶" },
                    { en: "I am Damon.", zh: "ÊàëÊòØ Damon„ÄÇ", img: "üôã‚Äç‚ôÇÔ∏è" },
                    { en: "I'm Damon.", zh: "ÊàëÊòØ Damon„ÄÇ", img: "‚ú®" }
                ]
            },
            {
                category: "2. Age (Âπ¥ÈΩ°)",
                subtitle: "How old are you?",
                icon: "fa-birthday-cake",
                color: "border-l-8 border-pink-400",
                sentences: [
                    { en: "I'm seven years old.", zh: "Êàë‰∏ÉÊ≠≤„ÄÇ", img: "7Ô∏è‚É£" },
                    { en: "I'm eight years old.", zh: "ÊàëÂÖ´Ê≠≤„ÄÇ", img: "8Ô∏è‚É£" }
                ]
            },
            {
                category: "3. Feelings (ÂøÉÊÉÖ)",
                subtitle: "How are you today?",
                icon: "fa-smile-beam",
                color: "border-l-8 border-green-400",
                sentences: [
                    { en: "I'm great.", zh: "ÊàëÂæàÊ£í„ÄÇ", img: "ü§©" },
                    { en: "I'm good.", zh: "ÊàëÂæàÂ•Ω„ÄÇ", img: "üëç" },
                    { en: "I'm fine.", zh: "Êàë‰∏çÈåØ„ÄÇ", img: "üëå" },
                    { en: "I'm happy.", zh: "ÊàëÂæàÈñãÂøÉ„ÄÇ", img: "ü•∞" }
                ]
            },
            {
                category: "4. Weather (Â§©Ê∞£)",
                subtitle: "How's the weather?",
                icon: "fa-cloud-sun",
                color: "border-l-8 border-orange-400",
                sentences: [
                    { en: "It's sunny.", zh: "ÊòØÊô¥Â§©„ÄÇ", img: "‚òÄÔ∏è" },
                    { en: "It's cloudy.", zh: "ÊòØÈô∞Â§©„ÄÇ", img: "‚òÅÔ∏è" },
                    { en: "It's rainy.", zh: "ÊòØÈõ®Â§©„ÄÇ", img: "‚òî" },
                    { en: "It's windy.", zh: "È¢®ÂæàÂ§ß„ÄÇ", img: "üçÉ" },
                    { en: "It's snowy.", zh: "‰∏ãÈõ™‰∫Ü„ÄÇ", img: "‚õÑ" },
                    { en: "It's stormy.", zh: "ÊúâÊö¥È¢®Èõ®„ÄÇ", img: "‚õàÔ∏è" }
                ]
            },
            {
                category: "5. Phonics (ÁôºÈü≥)",
                subtitle: "Listen & Repeat",
                icon: "fa-shapes",
                color: "border-l-8 border-purple-400",
                sentences: [
                    { en: "A, a, apple, ant", zh: "Aa (ËòãÊûú, ËûûËüª)", img: "üçé" },
                    { en: "B, b, ball, bear", zh: "Bb (ÁêÉ, ÁÜä)", img: "üêª" },
                    { en: "C, c, cat, car", zh: "Cc (Ë≤ì, ËªäÂ≠ê)", img: "üê±" },
                    { en: "D, d, dog, duck", zh: "Dd (Áãó, È¥®Â≠ê)", img: "üê∂" },
                    { en: "E, e, egg, elephant", zh: "Ee (Ëõã, Â§ßË±°)", img: "üêò" },
                    { en: "F, f, fish, fan", zh: "Ff (È≠ö, È¢®Êâá)", img: "üêü" },
                    { en: "G, g, goat, girl", zh: "Gg (Â±±Áæä, Â•≥Â≠©)", img: "üêê" },
                    { en: "H, h, hat, hot", zh: "Hh (Â∏ΩÂ≠ê, ÁÜ±)", img: "üé©" }
                ]
            },
            {
                category: "6. Singular (ÂñÆÊï∏)",
                subtitle: "This is / That is",
                icon: "fa-cube",
                color: "border-l-8 border-teal-400",
                sentences: [
                    { en: "This is an ant.", zh: "ÈÄôÊòØ‰∏ÄÈöªËûûËüª„ÄÇ", img: "üêú" },
                    { en: "That is an ant.", zh: "ÈÇ£ÊòØ‰∏ÄÈöªËûûËüª„ÄÇ", img: "üêú" },
                    { en: "This is a cat.", zh: "ÈÄôÊòØ‰∏ÄÈöªË≤ì„ÄÇ", img: "üê±" },
                    { en: "That is a cat.", zh: "ÈÇ£ÊòØ‰∏ÄÈöªË≤ì„ÄÇ", img: "üêà" },
                    { en: "This is a bear.", zh: "ÈÄôÊòØ‰∏ÄÈöªÁÜä„ÄÇ", img: "üêª" },
                    { en: "That is a bear.", zh: "ÈÇ£ÊòØ‰∏ÄÈöªÁÜä„ÄÇ", img: "üß∏" },
                    { en: "This is an insect.", zh: "ÈÄôÊòØ‰∏ÄÈöªÊòÜËü≤„ÄÇ", img: "ü™≤" },
                    { en: "That is an insect.", zh: "ÈÇ£ÊòØ‰∏ÄÈöªÊòÜËü≤„ÄÇ", img: "üêû" },
                    { en: "This is an apple.", zh: "ÈÄôÊòØ‰∏ÄÈ°ÜËòãÊûú„ÄÇ", img: "üçé" },
                    { en: "That is an apple.", zh: "ÈÇ£ÊòØ‰∏ÄÈ°ÜËòãÊûú„ÄÇ", img: "üçè" },
                    { en: "This is a monkey.", zh: "ÈÄôÊòØ‰∏ÄÈöªÁå¥Â≠ê„ÄÇ", img: "üêµ" },
                    { en: "That is a monkey.", zh: "ÈÇ£ÊòØ‰∏ÄÈöªÁå¥Â≠ê„ÄÇ", img: "üêí" }
                ]
            },
            {
                category: "7. Plural (Ë§áÊï∏)",
                subtitle: "These are / Those are",
                icon: "fa-cubes",
                color: "border-l-8 border-red-400",
                sentences: [
                    { en: "These are apples.", zh: "ÈÄô‰∫õÊòØËòãÊûú„ÄÇ", img: "üçé" },
                    { en: "Those are apples.", zh: "ÈÇ£‰∫õÊòØËòãÊûú„ÄÇ", img: "üçè" },
                    { en: "These are balls.", zh: "ÈÄô‰∫õÊòØÁêÉ„ÄÇ", img: "‚öΩ" },
                    { en: "Those are balls.", zh: "ÈÇ£‰∫õÊòØÁêÉ„ÄÇ", img: "üèÄ" },
                    { en: "These are cars.", zh: "ÈÄô‰∫õÊòØËªäÂ≠ê„ÄÇ", img: "üöó" },
                    { en: "Those are cars.", zh: "ÈÇ£‰∫õÊòØËªäÂ≠ê„ÄÇ", img: "üöï" },
                    { en: "These are hats.", zh: "ÈÄô‰∫õÊòØÂ∏ΩÂ≠ê„ÄÇ", img: "üß¢" },
                    { en: "Those are hats.", zh: "ÈÇ£‰∫õÊòØÂ∏ΩÂ≠ê„ÄÇ", img: "üëí" },
                    { en: "These are jackets.", zh: "ÈÄô‰∫õÊòØÂ§æÂÖã„ÄÇ", img: "üß•" },
                    { en: "Those are jackets.", zh: "ÈÇ£‰∫õÊòØÂ§æÂÖã„ÄÇ", img: "üß•" },
                    { en: "These are lions.", zh: "ÈÄô‰∫õÊòØÁçÖÂ≠ê„ÄÇ", img: "ü¶Å" },
                    { en: "Those are lions.", zh: "ÈÇ£‰∫õÊòØÁçÖÂ≠ê„ÄÇ", img: "ü¶Å" }
                ]
            },
            {
                category: "8. Colors & Clothes (È°èËâ≤/Ë°£Áâ©)",
                subtitle: "What color is it?",
                icon: "fa-tshirt",
                color: "border-l-8 border-indigo-400",
                sentences: [
                    { en: "It's a blue T-shirt.", zh: "ÊòØ‰∏Ä‰ª∂ËóçËâ≤ T ÊÅ§„ÄÇ", img: "üëï" },
                    { en: "It's a green skirt.", zh: "ÊòØ‰∏Ä‰ª∂Á∂†Ëâ≤Ë£ôÂ≠ê„ÄÇ", img: "üëó" }, // Á∂†Ëâ≤Ë£ôÂ≠êÁÑ°Á≤æÁ¢∫ EmojiÔºåÁî®ÈÄöÁî®Ë£ôÂ≠ê
                    { en: "It's a yellow cap.", zh: "ÊòØ‰∏ÄÈ†ÇÈªÉËâ≤Â∏ΩÂ≠ê„ÄÇ", img: "üß¢" },
                    { en: "It's a pink dress.", zh: "ÊòØ‰∏Ä‰ª∂Á≤âËâ≤Ê¥ãË£ù„ÄÇ", img: "üëö" },
                    { en: "It's a red jacket.", zh: "ÊòØ‰∏Ä‰ª∂Á¥ÖËâ≤Â§ñÂ•ó„ÄÇ", img: "üß•" }
                ]
            },
            {
                category: "9. Fruits (Ê∞¥ÊûúÂñúÂ•Ω)",
                subtitle: "Which fruit do you like?",
                icon: "fa-lemon",
                color: "border-l-8 border-lime-500",
                sentences: [
                    { en: "I like apples.", zh: "ÊàëÂñúÊ≠°ËòãÊûú„ÄÇ", img: "üçé" },
                    { en: "I like bananas.", zh: "ÊàëÂñúÊ≠°È¶ôËïâ„ÄÇ", img: "üçå" },
                    { en: "I like mangos.", zh: "ÊàëÂñúÊ≠°ËäíÊûú„ÄÇ", img: "ü•≠" },
                    { en: "I like papayas.", zh: "ÊàëÂñúÊ≠°Êú®Áìú„ÄÇ", img: "üçà" },
                    { en: "I like guavas.", zh: "ÊàëÂñúÊ≠°Ëä≠Ê®Ç„ÄÇ", img: "üçê" }
                ]
            },
            {
                category: "10. Math (Êï∏Â≠∏)",
                subtitle: "Read the problem",
                icon: "fa-calculator",
                color: "border-l-8 border-gray-500",
                sentences: [
                    { en: "Thirty-five plus twenty equals fifty-five.", zh: "35 + 20 = 55", img: "‚ûï" },
                    { en: "One hundred minus fifteen equals eighty-five.", zh: "100 - 15 = 85", img: "‚ûñ" }
                ]
            }
        ];

        // ÊâÅÂπ≥ÂåñÊâÄÊúâÂè•Â≠ê
        let allSentencesFlat = [];
        lessonData.forEach(section => {
            section.sentences.forEach(s => allSentencesFlat.push(s));
        });

        // === Ê†∏ÂøÉÂäüËÉΩËÆäÊï∏ ===
        const synth = window.speechSynthesis;
        let sentencesToPlay = [];
        let isPlayingAll = false;
        let currentUtterance = null;
        let currentQuizItem = null;
        let score = 0;
        let isQuizMode = false;
        let speechRate = 0.75; // È†êË®≠ÊÖ¢ÈÄü

        // === 1. ÂàùÂßãÂåñÈ†ÅÈù¢ ===
        function initPage() {
            const container = document.getElementById('content-list');
            
            lessonData.forEach((section, sIndex) => {
                const sectionEl = document.createElement('section');
                sectionEl.className = "bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition duration-300";
                
                // ÂçÄÂ°äÊ®ôÈ°å
                let headerHtml = `
                    <div class="p-4 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100 flex items-center gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-white shadow-sm text-${section.color.split('-')[3]}-500 border border-slate-100 flex items-center justify-center shrink-0 text-xl">
                            <i class="fas ${section.icon}"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-slate-800">${section.category}</h2>
                            ${section.subtitle ? `<p class="text-sm text-slate-500 font-medium">${section.subtitle}</p>` : ''}
                        </div>
                    </div>
                `;

                // Âè•Â≠êÂàóË°®
                let sentencesHtml = `<div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">`;
                
                section.sentences.forEach((item, iIndex) => {
                    const globalIndex = sentencesToPlay.length;
                    sentencesToPlay.push({ text: item.en, id: `card-${globalIndex}` }); 

                    // Âà§Êñ∑ÊòØÂê¶ÊúâÂúñÁâá
                    const imgHtml = item.img ? `<div class="sticker-img mr-3 w-12 text-center transform group-hover:scale-110 transition">${item.img}</div>` : '';

                    sentencesHtml += `
                        <div id="card-${globalIndex}" 
                             onclick="speak('${item.en.replace(/'/g, "\\'")}', 'card-${globalIndex}')" 
                             class="card-hover ${section.color} bg-white border border-slate-100 rounded-xl p-4 flex items-center justify-between cursor-pointer select-none group relative overflow-hidden">
                            
                            <div class="flex items-center flex-1">
                                ${imgHtml}
                                <div>
                                    <p class="en-text text-xl text-slate-700 font-bold group-hover:text-cyan-600 transition tracking-wide">${item.en}</p>
                                    <p class="text-sm text-slate-400 mt-1 font-medium">${item.zh}</p>
                                </div>
                            </div>
                            
                            <div class="w-10 h-10 rounded-full bg-slate-50 group-hover:bg-cyan-50 text-slate-300 group-hover:text-cyan-500 flex items-center justify-center transition shrink-0 ml-2">
                                <i class="fas fa-volume-up"></i>
                            </div>
                        </div>
                    `;
                });
                
                sentencesHtml += `</div>`;
                sectionEl.innerHTML = headerHtml + sentencesHtml;
                container.appendChild(sectionEl);
            });
        }

        // === Êõ¥Êñ∞Ë™ûÈÄü ===
        function updateSpeed() {
            const select = document.getElementById('speed-select');
            speechRate = parseFloat(select.value);
            // Â¶ÇÊûúÊ≠£Âú®Êí≠ÊîæÔºåÂÅúÊ≠¢‰∏¶ÊèêÁ§∫Áî®Êà∂ÈáçÊñ∞ÈªûÊìä
            if (synth.speaking) {
                stopAudio();
            }
        }

        // === 2. Ê®°ÂºèÂàáÊèõÈÇèËºØ ===
        function switchMode(mode) {
            const practiceView = document.getElementById('view-practice');
            const quizView = document.getElementById('view-quiz');
            const tabPractice = document.getElementById('tab-practice');
            const tabQuiz = document.getElementById('tab-quiz');
            const scoreBoard = document.getElementById('score-board');

            stopAudio();

            if (mode === 'practice') {
                isQuizMode = false;
                practiceView.classList.remove('hidden');
                quizView.classList.add('hidden');
                
                tabPractice.className = "tab-active flex-1 py-2 rounded-lg text-center transition cursor-default";
                tabQuiz.className = "tab-inactive flex-1 py-2 rounded-lg text-center transition cursor-pointer";
                scoreBoard.classList.add('hidden');
            } else {
                isQuizMode = true;
                practiceView.classList.add('hidden');
                quizView.classList.remove('hidden');

                tabPractice.className = "tab-inactive flex-1 py-2 rounded-lg text-center transition cursor-pointer";
                tabQuiz.className = "tab-active flex-1 py-2 rounded-lg text-center transition cursor-default";
                scoreBoard.classList.remove('hidden');
                
                if(!currentQuizItem) startQuiz();
            }
        }

        // === 3. Ë™ûÈü≥ÂêàÊàêÂäüËÉΩ ===
        function speak(text, elementId, onEndCallback) {
            if (synth.speaking) synth.cancel();

            // UI Êõ¥Êñ∞
            document.querySelectorAll('.playing-highlight').forEach(el => el.classList.remove('playing-highlight'));
            if (elementId && !isQuizMode) {
                const el = document.getElementById(elementId);
                if (el) {
                    el.classList.add('playing-highlight');
                    if (isPlayingAll) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            const utterance = new SpeechSynthesisUtterance(text);
            currentUtterance = utterance;
            utterance.lang = 'en-US';
            utterance.rate = speechRate; // ‰ΩøÁî®Áï∂ÂâçË®≠ÂÆöÁöÑË™ûÈÄü
            utterance.pitch = 1.1;

            const voices = synth.getVoices();
            const preferredVoice = voices.find(v => v.name.includes('Google US English')) || voices.find(v => v.lang === 'en-US');
            if (preferredVoice) utterance.voice = preferredVoice;

            utterance.onend = () => {
                if (elementId && !isQuizMode) {
                    const el = document.getElementById(elementId);
                    if (el) el.classList.remove('playing-highlight');
                }
                if (onEndCallback) onEndCallback();
            };

            synth.speak(utterance);
        }

        // === 4. Êí≠ÊîæÊéßÂà∂ ===
        function playAll() {
            if (isPlayingAll) return;
            isPlayingAll = true;
            updatePlayButtons();
            
            let index = 0;
            function playNext() {
                if (!isPlayingAll) return;
                if (index < sentencesToPlay.length) {
                    const item = sentencesToPlay[index];
                    speak(item.text, item.id, () => {
                        index++;
                        if (isPlayingAll) setTimeout(playNext, 1200); // Á®çÂæÆÂ¢ûÂä†ÈñìÈöî
                    });
                } else {
                    stopAudio();
                }
            }
            playNext();
        }

        function stopAudio() {
            synth.cancel();
            isPlayingAll = false;
            updatePlayButtons();
            document.querySelectorAll('.playing-highlight').forEach(el => el.classList.remove('playing-highlight'));
        }

        function updatePlayButtons() {
            const playBtn = document.getElementById('playAllBtn');
            const stopBtn = document.getElementById('stopBtn');
            if (isPlayingAll) {
                playBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
            } else {
                playBtn.classList.remove('hidden');
                stopBtn.classList.add('hidden');
            }
        }

        // === 5. Ê∏¨È©óÊ®°Âºè ===
        function startQuiz() {
            nextQuizQuestion();
        }

        function nextQuizQuestion() {
            const randomIndex = Math.floor(Math.random() * allSentencesFlat.length);
            currentQuizItem = allSentencesFlat[randomIndex];
            
            let options = [currentQuizItem];
            while (options.length < 3) {
                const randomDistractor = allSentencesFlat[Math.floor(Math.random() * allSentencesFlat.length)];
                if (!options.includes(randomDistractor) && randomDistractor.zh !== currentQuizItem.zh) {
                    options.push(randomDistractor);
                }
            }
            options.sort(() => Math.random() - 0.5);

            const optionsContainer = document.getElementById('quiz-options');
            const feedbackEl = document.getElementById('quiz-feedback');
            
            feedbackEl.innerHTML = "<i class='fas fa-headphones-alt mr-2'></i> ÈªûÂñáÂè≠ËÅΩÈ°åÁõÆÔºåÂÜçÈÅ∏Á≠îÊ°à";
            feedbackEl.className = "h-14 bg-white border-t border-slate-100 flex items-center justify-center text-sm font-bold text-slate-400";

            let html = '';
            options.forEach((opt, idx) => {
                // Ê∏¨È©óÈÅ∏È†Ö‰πüÈ°ØÁ§∫ÂúñÁâáÔºåÂ¢ûÂä†ËÅØÊÉ≥
                const optImg = opt.img ? `<span class="text-2xl mr-2 filter drop-shadow-sm">${opt.img}</span>` : '';
                html += `
                    <div onclick="checkAnswer(this, '${opt.zh.replace(/'/g, "\\'")}')" 
                         class="quiz-option bg-white border-2 border-slate-200 rounded-xl p-4 text-center text-slate-700 font-bold text-lg shadow-sm flex items-center justify-center h-20">
                        ${optImg} ${opt.zh}
                    </div>
                `;
            });
            optionsContainer.innerHTML = html;

            setTimeout(() => playQuizAudio(), 400);
        }

        function playQuizAudio() {
            if (!currentQuizItem) return;
            const icon = document.getElementById('quiz-speaker-icon');
            icon.classList.add('text-cyan-400', 'scale-110');
            setTimeout(() => icon.classList.remove('text-cyan-400', 'scale-110'), 200);
            
            speak(currentQuizItem.en, null, null);
        }

        function checkAnswer(el, selectedZh) {
            if (document.querySelector('.quiz-option.correct') || document.querySelector('.quiz-option.wrong')) return;

            const feedbackEl = document.getElementById('quiz-feedback');

            if (selectedZh === currentQuizItem.zh) {
                el.classList.add('correct');
                el.innerHTML = `<i class="fas fa-check-circle text-2xl mr-2"></i> ${selectedZh}`;
                
                feedbackEl.innerHTML = "<span class='text-green-600 text-lg'><i class='fas fa-laugh-squint'></i> Correct! Á≠îÂ∞ç‰∫ÜÔºÅ</span>";
                feedbackEl.className = "h-14 bg-green-50 border-t border-green-100 flex items-center justify-center font-bold animate-pulse";
                
                score += 10;
                updateScore();
                fireConfetti();
                
                setTimeout(nextQuizQuestion, 2000);
            } else {
                el.classList.add('wrong');
                feedbackEl.innerHTML = "<span class='text-red-500 text-lg'><i class='fas fa-times-circle'></i> Oops! ÂÜçË©¶‰∏ÄÊ¨° (Try again)</span>";
                feedbackEl.className = "h-14 bg-red-50 border-t border-red-100 flex items-center justify-center font-bold";
                
                // Èôç‰ΩéË™ûÈÄüÂÜçÂî∏‰∏ÄÊ¨°
                const originalRate = speechRate;
                speechRate = 0.5; // ËÆäÊÖ¢
                setTimeout(() => {
                    playQuizAudio();
                    speechRate = originalRate; // ÊÅ¢Âæ©
                }, 800);
            }
        }

        function updateScore() {
            document.getElementById('current-score').innerText = score;
        }

        function fireConfetti() {
            confetti({
                particleCount: 150,
                spread: 80,
                origin: { y: 0.6 },
                colors: ['#06b6d4', '#f59e0b', '#ef4444', '#10b981']
            });
        }

        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };

        // ÂïüÂãï
        initPage();

    </script>
</body>
</html>
