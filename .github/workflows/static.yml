<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小學二年級英文聽力複習 (Grade 2 English Review)</title>
    <!-- 使用 Tailwind CSS 進行快速排版 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入圖標庫 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts 字型 -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* 淺藍色背景 */
        }
        .en-text {
            font-family: 'Fredoka', sans-serif; /* 圓潤可愛的英文字體 */
        }
        /* 播放時的高亮效果 */
        .playing-highlight {
            background-color: #fef08a !important; /* 黃色高亮 */
            border-color: #eab308 !important;
            transform: scale(1.02);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        /* 自定義捲軸 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #93c5fd; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #60a5fa; 
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- 頂部標題區 -->
    <header class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-graduation-cap"></i> Grade 2 English
                </h1>
                <p class="text-blue-100 text-sm">小學二年級英文複習</p>
            </div>
            
            <!-- 全局控制按鈕 -->
            <div class="flex gap-2">
                <button id="stopBtn" onclick="stopAudio()" class="hidden bg-red-400 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-full shadow transition flex items-center gap-2 text-sm">
                    <i class="fas fa-stop"></i> 停止
                </button>
                <button id="playAllBtn" onclick="playAll()" class="bg-yellow-400 hover:bg-yellow-500 text-blue-900 font-bold py-2 px-4 rounded-full shadow transition flex items-center gap-2 text-sm md:text-base animate-pulse-slow">
                    <i class="fas fa-play-circle text-lg"></i> 全部播放
                </button>
            </div>
        </div>
    </header>

    <!-- 主要內容區 -->
    <main class="max-w-4xl mx-auto px-4 py-6 space-y-8" id="content-container">
        <!-- 內容將由 JavaScript 動態生成 -->
    </main>

    <!-- 底部版權/說明 -->
    <footer class="text-center text-gray-500 text-sm py-6">
        <p>點擊喇叭圖示或句子即可發音 • 適合家長與孩子共學</p>
    </footer>

    <script>
        // === 教材資料庫 ===
        const lessonData = [
            {
                category: "Greeting (問候)",
                icon: "fa-hand-sparkles",
                color: "border-l-4 border-yellow-400",
                sentences: [
                    { en: "Hi! Good morning.", zh: "嗨！早安。" },
                    { en: "Hello! Good afternoon.", zh: "哈囉！午安。" }
                ]
            },
            {
                category: "1. Self Introduction (自我介紹)",
                subtitle: "Q: What's your name?",
                icon: "fa-user-circle",
                color: "border-l-4 border-blue-400",
                sentences: [
                    { en: "My name is Tom.", zh: "我的名字是 Damon。" },
                    { en: "I am Mary.", zh: "我是 Damon。" },
                    { en: "I'm Eric.", zh: "我是 Damon。" }
                ]
            },
            {
                category: "2. Age (年齡)",
                subtitle: "Q: How old are you?",
                icon: "fa-birthday-cake",
                color: "border-l-4 border-pink-400",
                sentences: [
                    { en: "I'm seven years old.", zh: "我七歲。" },
                    { en: "I'm eight years old.", zh: "我八歲。" }
                ]
            },
            {
                category: "3. Feelings (心情)",
                subtitle: "Q: How are you today?",
                icon: "fa-smile-beam",
                color: "border-l-4 border-green-400",
                sentences: [
                    { en: "I'm great.", zh: "我很棒。" },
                    { en: "I'm good.", zh: "我很好。" },
                    { en: "I'm fine.", zh: "我不錯。" },
                    { en: "I'm happy.", zh: "我很開心。" }
                ]
            },
            {
                category: "4. Weather (天氣)",
                subtitle: "Q: How's the weather?",
                icon: "fa-cloud-sun",
                color: "border-l-4 border-orange-400",
                sentences: [
                    { en: "It's sunny.", zh: "是晴天。" },
                    { en: "It's cloudy.", zh: "是陰天。" },
                    { en: "It's rainy.", zh: "是雨天。" },
                    { en: "It's windy.", zh: "風很大。" },
                    { en: "It's snowy.", zh: "下雪了。" },
                    { en: "It's stormy.", zh: "有暴風雨。" }
                ]
            },
            {
                category: "5. Phonics (字母發音)",
                subtitle: "Listen and Repeat (聽並跟讀)",
                icon: "fa-shapes",
                color: "border-l-4 border-purple-400",
                sentences: [
                    { en: "A, a, apple, ant", zh: "Aa (蘋果, 螞蟻)" },
                    { en: "B, b, ball, bear", zh: "Bb (球, 熊)" },
                    { en: "C, c, cat, car", zh: "Cc (貓, 車子)" },
                    { en: "D, d, dog, duck", zh: "Dd (狗, 鴨子)" },
                    { en: "E, e, egg, elephant", zh: "Ee (蛋, 大象)" },
                    { en: "F, f, fish, fan", zh: "Ff (魚, 風扇)" },
                    { en: "G, g, goat, girl", zh: "Gg (山羊, 女孩)" },
                    { en: "H, h, hat, hot", zh: "Hh (帽子, 熱)" }
                ]
            },
            {
                category: "6. Singular Nouns (單數句型)",
                subtitle: "Q: What is this? / What is that?",
                icon: "fa-cube",
                color: "border-l-4 border-teal-400",
                sentences: [
                    { en: "This is an ant.", zh: "這是一隻螞蟻。" },
                    { en: "That is an ant.", zh: "那是一隻螞蟻。" },
                    { en: "This is a cat.", zh: "這是一隻貓。" },
                    { en: "That is a cat.", zh: "那是一隻貓。" },
                    { en: "This is a bear.", zh: "這是一隻熊。" },
                    { en: "That is a bear.", zh: "那是一隻熊。" },
                    { en: "This is an insect.", zh: "這是一隻昆蟲。" },
                    { en: "That is an insect.", zh: "那是一隻昆蟲。" },
                    { en: "This is an apple.", zh: "這是一顆蘋果。" },
                    { en: "That is an apple.", zh: "那是一顆蘋果。" },
                    { en: "This is a monkey.", zh: "這是一隻猴子。" },
                    { en: "That is a monkey.", zh: "那是一隻猴子。" }
                ]
            },
            {
                category: "7. Plural Nouns (複數句型)",
                subtitle: "Q: What are these? / What are those?",
                icon: "fa-cubes",
                color: "border-l-4 border-red-400",
                sentences: [
                    { en: "These are apples.", zh: "這些是蘋果。" },
                    { en: "Those are apples.", zh: "那些是蘋果。" },
                    { en: "These are balls.", zh: "這些是球。" },
                    { en: "Those are balls.", zh: "那些是球。" },
                    { en: "These are cars.", zh: "這些是車子。" },
                    { en: "Those are cars.", zh: "那些是車子。" },
                    { en: "These are hats.", zh: "這些是帽子。" },
                    { en: "Those are hats.", zh: "那些是帽子。" },
                    { en: "These are jackets.", zh: "這些是夾克。" },
                    { en: "Those are jackets.", zh: "那些是夾克。" },
                    { en: "These are lions.", zh: "這些是獅子。" },
                    { en: "Those are lions.", zh: "那些是獅子。" }
                ]
            }
        ];

        // === 應用程式邏輯 ===
        const container = document.getElementById('content-container');
        const synth = window.speechSynthesis;
        let sentencesToPlay = [];
        let isPlayingAll = false;
        let currentUtterance = null;

        // 1. 初始化頁面
        function initPage() {
            lessonData.forEach((section, sIndex) => {
                const sectionEl = document.createElement('section');
                sectionEl.className = "bg-white rounded-xl shadow-md overflow-hidden";
                
                // 區塊標題
                let headerHtml = `
                    <div class="p-4 bg-gray-50 border-b flex items-start gap-3">
                        <div class="mt-1 w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center shrink-0">
                            <i class="fas ${section.icon}"></i>
                        </div>
                        <div>
                            <h2 class="text-lg md:text-xl font-bold text-gray-800">${section.category}</h2>
                            ${section.subtitle ? `<p class="text-sm text-gray-500 font-medium mt-1">${section.subtitle}</p>` : ''}
                        </div>
                    </div>
                `;

                // 句子列表
                let sentencesHtml = `<div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-3">`;
                
                section.sentences.forEach((item, iIndex) => {
                    // 將資料存入全域陣列方便 "全部播放"
                    const globalIndex = sentencesToPlay.length;
                    sentencesToPlay.push({ text: item.en, id: `card-${globalIndex}` });

                    sentencesHtml += `
                        <div id="card-${globalIndex}" 
                             onclick="speak('${item.en.replace(/'/g, "\\'")}', 'card-${globalIndex}')" 
                             class="card-hover ${section.color} bg-white border border-gray-100 rounded-lg p-3 flex items-center justify-between cursor-pointer transition select-none group">
                            <div class="flex-1 pr-2">
                                <p class="en-text text-lg text-gray-800 font-semibold group-hover:text-blue-600 transition">${item.en}</p>
                                <p class="text-sm text-gray-400 mt-1">${item.zh}</p>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-gray-100 group-hover:bg-blue-100 text-gray-400 group-hover:text-blue-500 flex items-center justify-center transition shrink-0">
                                <i class="fas fa-volume-up"></i>
                            </div>
                        </div>
                    `;
                });
                
                sentencesHtml += `</div>`;
                sectionEl.innerHTML = headerHtml + sentencesHtml;
                container.appendChild(sectionEl);
            });
        }

        // 2. 語音合成函數
        function speak(text, elementId, onEndCallback) {
            // 如果正在播放其他內容，先停止
            if (synth.speaking) {
                synth.cancel();
            }

            // UI 更新：移除舊的高亮，新增新的高亮
            document.querySelectorAll('.playing-highlight').forEach(el => el.classList.remove('playing-highlight'));
            if (elementId) {
                const el = document.getElementById(elementId);
                if (el) {
                    el.classList.add('playing-highlight');
                    // 確保元素在視野內 (如果是自動播放模式)
                    if (isPlayingAll) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }

            const utterance = new SpeechSynthesisUtterance(text);
            currentUtterance = utterance;
            
            // 設定語音參數 (針對兒童優化)
            utterance.lang = 'en-US';
            utterance.rate = 0.8; // 語速稍微放慢
            utterance.pitch = 1.1; // 語調稍微提高，較親切
            
            // 嘗試獲取高品質語音
            const voices = synth.getVoices();
            const preferredVoice = voices.find(v => v.name.includes('Google US English')) || 
                                   voices.find(v => v.lang === 'en-US');
            if (preferredVoice) utterance.voice = preferredVoice;

            // 播放結束後的處理
            utterance.onend = () => {
                if (elementId) {
                    const el = document.getElementById(elementId);
                    if (el) el.classList.remove('playing-highlight');
                }
                currentUtterance = null;
                if (onEndCallback) onEndCallback();
            };

            utterance.onerror = (e) => {
                console.error('Speech error:', e);
                if (elementId) {
                    const el = document.getElementById(elementId);
                    if (el) el.classList.remove('playing-highlight');
                }
                currentUtterance = null;
                // 即使出錯也嘗試繼續下一個 (如果是播放列表)
                if (onEndCallback) onEndCallback();
            };

            synth.speak(utterance);
        }

        // 3. 全部播放邏輯
        function playAll() {
            if (isPlayingAll) return; // 避免重複點擊

            isPlayingAll = true;
            updatePlayButtons();
            
            let index = 0;

            function playNext() {
                if (!isPlayingAll) return; // 如果被停止了

                if (index < sentencesToPlay.length) {
                    const item = sentencesToPlay[index];
                    speak(item.text, item.id, () => {
                        index++;
                        // 句與句之間停頓 1 秒
                        if (isPlayingAll) {
                            setTimeout(playNext, 1000);
                        }
                    });
                } else {
                    stopAudio(); // 播完了
                }
            }

            playNext();
        }

        // 4. 停止播放
        function stopAudio() {
            synth.cancel();
            isPlayingAll = false;
            updatePlayButtons();
            document.querySelectorAll('.playing-highlight').forEach(el => el.classList.remove('playing-highlight'));
        }

        function updatePlayButtons() {
            const playBtn = document.getElementById('playAllBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (isPlayingAll) {
                playBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
            } else {
                playBtn.classList.remove('hidden');
                stopBtn.classList.add('hidden');
            }
        }

        // 解決 Chrome 語音列表加載延遲問題
        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };

        // 啟動
        initPage();

    </script>
</body>
</html>
